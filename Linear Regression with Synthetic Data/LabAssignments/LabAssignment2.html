<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Learning Rate Experiment</title>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    canvas {
      max-width: 900px;
    }
    .note {
      margin-top: 15px;
      padding: 10px;
      background: #eef2f7;
      width: fit-content;
    }
  </style>
</head>
<body>

<h2>2. Learning Rate vs Convergence</h2>
<p>Open Console (F12) and run: <b>runExperiment(0.005)</b></p>

<canvas id="lossChart"></canvas>

<div class="note" id="statusBox">
  Console ready. Try runExperiment(0.005), runExperiment(0.02)
</div>

<script>
  const inputX = tf.tensor2d([1, 2, 3, 4, 5, 6], [6, 1]);
  const outputY = tf.tensor2d([4, 7, 10, 13, 16, 19], [6, 1]); // y = 3x + 1

  const chartData = {
    labels: [],
    datasets: []
  };

  const ctx = document.getElementById("lossChart").getContext("2d");
  const lossChart = new Chart(ctx, {
    type: "line",
    data: chartData,
    options: {
      responsive: true,
      plugins: {
        legend: { position: "top" }
      },
      scales: {
        y: { title: { display: true, text: "MSE Loss" } },
        x: { title: { display: true, text: "Epoch" } }
      }
    }
  });

  async function runExperiment(lrValue) {
    console.clear();
    console.log("Starting training with LR =", lrValue);

    const losses = [];
    const model = tf.sequential();
    model.add(tf.layers.dense({ units: 1, inputShape: [1] }));

    model.compile({
      optimizer: tf.train.sgd(lrValue),
      loss: "meanSquaredError"
    });

    await model.fit(inputX, outputY, {
      epochs: 25,
      callbacks: {
        onEpochEnd: (epoch, logs) => {
          losses.push(logs.loss);
          console.log(
            `Epoch ${epoch + 1} | MSE Loss: ${logs.loss.toFixed(3)}`
          );
        }
      }
    });

    chartData.labels = losses.map((_, i) => `E${i + 1}`);
    chartData.datasets.push({
      label: `LR ${lrValue} (Stable)`,
      data: losses,
      borderWidth: 2,
      fill: false
    });

    lossChart.update();

    document.getElementById("statusBox").innerText =
      `Training done for LR ${lrValue} | Final Loss: ${losses.at(-1).toFixed(4)}`;

    console.log("Training complete. Model converged.");
  }
</script>

</body>
</html>